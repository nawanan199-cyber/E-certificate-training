<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Certificate Checker</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:30px; background:#F9FBE7; color:#333; }
.container { max-width:1000px; margin:0 auto; background:#fff; padding:40px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.1); }
.header-section { display:flex; flex-direction:column; align-items:center; margin-bottom:30px; }
.mascot-img { width:120px; height:120px; border-radius:50%; border:5px solid #4CAF50; object-fit:cover; margin-bottom:20px; }
.header { text-align:center; color:#2E7D32; font-size:34px; font-weight:800; border-bottom:4px solid #4CAF50; padding-bottom:10px; width:100%; max-width:450px; }
.search-bar { display:flex; gap:15px; margin-bottom:30px; }
.search-input { flex-grow:1; padding:15px 20px; border:2px solid #ccc; border-radius:10px; font-size:16px; }
.search-input:focus { border-color:#4CAF50; }
.search-button { background:#4CAF50; color:#fff; padding:15px 30px; border:none; border-radius:10px; font-size:16px; font-weight:bold; cursor:pointer; }
.search-button:hover { background:#388E3C; }
.result-name { background:#E8F5E9; padding:18px; margin-bottom:25px; border-radius:12px; font-weight:bold; color:#388E3C; border:1px solid #C8E6C9; display:none; }
.alert-message { background:#FFE0B2; color:#E65100; padding:15px; margin-top:20px; border-radius:10px; text-align:center; font-weight:bold; display:none; }
.data-table { width:100%; border-collapse:collapse; margin-top:20px; display:none; }
.data-table th, .data-table td { padding:15px; border:1px solid #e0e0e0; }
.data-table th { background:#f5f5f5; font-weight:bold; color:#495057; }
.data-table tr:nth-child(even) { background:#fcfcfc; }
.data-table tr:hover { background:#DCEDC8; }
</style>
</head>
<body>
<div class="container">
    <div class="header-section">
        <img src="Gemini_Generated_Image_60ae4y60ae4y60ae.png" class="mascot-img" alt="Mascot">
        <div class="header">Certificate Checker</div>
    </div>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="กรอกชื่อเต็ม หรือบางส่วน">
        <button id="searchButton">Search</button>
    </div>

    <div id="alertMessage" class="alert-message">โปรดกรอกข้อความที่ต้องการค้นหา</div>
    <div id="nameResult" class="result-name"></div>
    <table class="data-table" id="dataTable">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
    </table>
    <div id="noResult" class="alert-message" style="background:#fffae0; color:#856404; border:1px solid #ffbb00; display:none;">ไม่พบข้อมูลใบรับรองสำหรับคำค้นหานี้</div>
</div>

<script>
const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwruaAM7whazqsr-UP3nFvbQlGZHvZWeed-OhqQrGhINwWakPICvAPDS04ciCd_SJCQ/exec";
const COLUMNS_TO_HIDE = ['NO','NAME','COMPANY','NO.'];

const searchInput = document.getElementById('searchInput');
const searchButton = document.getElementById('searchButton');
const alertMessage = document.getElementById('alertMessage');
const nameResult = document.getElementById('nameResult');
const dataTable = document.getElementById('dataTable');
const tableHead = document.getElementById('tableHead');
const tableBody = document.getElementById('tableBody');
const noResult = document.getElementById('noResult');

function hideAll() {
    alertMessage.style.display='none';
    nameResult.style.display='none';
    dataTable.style.display='none';
    noResult.style.display='none';
}

searchButton.addEventListener('click', runSearch);
searchInput.addEventListener('keypress', e => { if(e.key==='Enter') runSearch(); });

async function runSearch() {
    hideAll();
    const query = searchInput.value.trim();
    if(!query){ alertMessage.style.display='block'; return; }

    try{
        const res = await fetch(`${GAS_WEB_APP_URL}?name=${encodeURIComponent(query)}`);
        const results = await res.json();

        if(results.error){ alertMessage.textContent=results.error; alertMessage.style.display='block'; return; }
        if(results.length===0){ noResult.style.display='block'; return; }

        // แสดงชื่อและบริษัท
        const first = results[0];
        nameResult.innerHTML=`Name: <strong>${first.NAME || 'ไม่ระบุ'}</strong> | Company: <strong>${first.COMPANY || 'ไม่ระบุ'}</strong>`;
        nameResult.style.display='block';

        // สร้างตาราง
        tableHead.innerHTML=''; tableBody.innerHTML='';
        const headers = Object.keys(first);
        const trHead = document.createElement('tr');
        headers.forEach(h=>{
            if(!COLUMNS_TO_HIDE.includes(h.toUpperCase())){
                const th=document.createElement('th'); th.textContent=h; trHead.appendChild(th);
            }
        });
        tableHead.appendChild(trHead);

        results.forEach(row=>{
            const tr=document.createElement('tr');
            headers.forEach(h=>{
                if(!COLUMNS_TO_HIDE.includes(h.toUpperCase())){
                    const td=document.createElement('td'); td.textContent=row[h]||''; tr.appendChild(td);
                }
            });
            tableBody.appendChild(tr);
        });
        dataTable.style.display='table';

    }catch(err){
        alertMessage.textContent='เกิดข้อผิดพลาดในการดึงข้อมูล'; alertMessage.style.display='block';
        console.error(err);
    }
}
</script>
</body>
</html>
